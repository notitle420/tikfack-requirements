# F02 縦スクロール視聴・レコメンド 機能要件

## 1. 目的
- 縦型スクロールでサンプル動画を連続視聴できる体験を提供し、外部サービスへの誘導を促進する。
- ログインユーザーには視聴ログを活用したレコメンドを表示する。

## 2. 対象範囲・前提
- 入場（年齢確認）済みであること（F01）。
- ゲスト利用を許容する。お気に入り追加はログインが必須（F04）。
- 外部サービスから取得するメタ情報はタイトル・出演者・発売日を必須表示。
- サンプル動画とメタデータはDMM API経由で取得する。

## 3. 機能概要
- トップ画面に動画リストを縦スクロールで表示し、順次再生。
- ログインユーザーのトップはレコメンド結果を優先表示。
- 動画詳細にはメタ情報と外部サービスへの遷移リンクを表示。
- 視聴ログを必須で記録する（ゲストは匿名ID、ログインはユーザーIDと紐付け）。

## 4. 詳細要件
- リスト表示・再生
  - APIから取得した動画リストを縦に並べ、スクロール位置に応じて自動再生/停止を行う。
  - 現在の動画が表示されたタイミングで次の動画を先読みし、切替 1〜1.5 秒以内を満たす。
  - 1ページ分を再生し終えたタイミングで次ページの有無をチェック。存在する場合はシームレスに続きの動画をロードし、存在しない場合は「該当する動画がなくなりました」を表示。
  - メタ情報（タイトル・出演者・発売日）と外部サービス遷移リンクを各カードに表示。
- レコメンド
  - ログインユーザーのトップでは視聴ログやお気に入り傾向を元に並び替え/抽出したリストを返す。
  - レコメンドが提供できない場合は最新/人気などのデフォルトリストを返す。
  - 詳細はF09
- 視聴ログ
  - 必須項目: ユーザー識別子（匿名IDまたはユーザーID）、動画ID、再生開始/終了時刻、再生完了率、ページ番号。
  - 送信タイミング: 再生開始時、終了時、終了理由（完了/スキップ/スクロールアウト）を送信。
  - 詳細はF08
- 外部サービスへの移動
  - 各動画カードに外部サービスへのリンクを配置し、クリックイベントをログに残す。
- 自動再生ポリシー
  - ブラウザの自動再生制限に対応するため、初期再生は無音で行う。
  - 音声有効化はユーザー操作（タップ等）を必須とする。
- エラーハンドリング
  - DMM API取得エラー時はリトライ後にユーザー向けに「動画を読み込めませんでした」を表示し、再試行ボタンを提供。

## 5. 入出力
- 入力: ユーザー操作（スクロール、再生、外部リンククリック、お気に入り操作）。
- 出力: 動画リスト（メタ情報、サンプル動画URL、ページネーション情報）、レコメンド結果、視聴ログイベント。

## 6. 関連
- F01 入場・年齢確認: 入場前提。
- F03 検索・発売日サーチ: 同一UI上で検索結果を表示する場合の再利用を想定。
- F04 マイページ・お気に入り管理: お気に入り追加/解除が可能（ログイン必須）。
