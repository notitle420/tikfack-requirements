# F04 マイページ・お気に入り管理 機能要件

## 1. 目的
- ログインユーザーに個人設定とお気に入り管理の手段を提供し、継続利用とレコメンド精度向上を図る。

## 2. 対象範囲・前提
- 入場（年齢確認）済みかつログイン済みであること（JWT認証）。認証・ユーザー管理は F05 に従う。
- お気に入り対象: 動画、ジャンル、女優（F06/F10/F11 を統合管理）。
- メタ情報表示はタイトル・出演者・発売日を基本とする。

## 3. 機能概要
- マイページでプロフィール（ユーザー名）を表示し、編集画面への導線を提供する（F05 のユーザー名変更と同一ポリシーを適用）。
- お気に入り動画/ジャンル/女優の登録・解除・一覧表示ができる（F06/F10/F11 の UI からの操作を集約）。
- 縦スクロール視聴・検索結果から直接お気に入り登録ができ、マイページに反映される。

## 4. 詳細要件
- 認証・アクセス制御
  - マイページおよびお気に入り操作はログイン必須。未ログインの場合はログイン画面へ誘導。
- プロフィール編集
  - 表示項目: ユーザー名（必須）。
  - 編集項目: ユーザー名（必須）。変更後は即時反映し、以降の表示名として利用。
  - バリデーション: 文字数・禁止文字は設計で定義。変更履歴は保持不要。
- お気に入り管理
  - 追加/解除: 動画カード、ジャンルタグ、女優名から操作可能。操作後は状態を即時反映。
  - 一覧表示: マイページでお気に入り動画/ジャンル/女優をタブやセクションで表示。動画は縦スクロール表示を流用可。
  - 並び順: 追加日時降順を基本とし、設計で変更可。
- 連携
  - F02/F03でのお気に入り操作は本機能のAPIを利用し、マイページに同期。
  - F05 の認証状態とプロフィール情報を前提としてユーザー固有データを表示。
  - F06/F10/F11 のお気に入り UI/操作は本機能の API を経由して登録・解除を行い、整合性を保つ。
  - お気に入り情報はレコメンド（F09)に利用可能とする。
- ロギング
  - 追加/解除/一覧表示のイベントをユーザーID付きで保存し、異常時はエラーログを残す。

## 5. 入出力
- 入力: ユーザー名、追加/解除操作（動画ID、ジャンルID、女優ID）、一覧取得リクエスト。
- 出力: 更新後のプロフィール、現在のお気に入りリスト、操作結果ステータス、イベントログ。

## 6. 関連
- F02 縦スクロール視聴・レコメンド: 視聴画面からお気に入り操作をトリガー。
- F03 検索・発売日サーチ: 検索結果からお気に入り操作をトリガー。
- F05 ユーザー管理: 認証状態とユーザー名変更ポリシーを共有。
- F06 お気に入り動画: 動画お気に入りの登録・解除・一覧を統括管理。
- F09 レコメンド: お気に入り情報を学習データとして活用。
- F10 お気に入りジャンル: ジャンルお気に入りの登録・解除・一覧を統括管理。
- F11 お気に入り女優: 女優お気に入りの登録・解除・一覧を統括管理。
