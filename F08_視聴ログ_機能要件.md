# F08 視聴ログ 機能要件

## 1. 目的
- 視聴行動を記録し、レコメンドや人気分析、障害分析に活用する。

## 2. 対象範囲・前提
- 年齢確認（F01）通過済みであること。
- ログイン／未ログインに関わらず視聴ログ収集は行う。

## 3. 機能概要
- 動画再生開始・終了ごとに視聴ログイベントを収集し、サーバに送信する。
- 収集したログはレコメンド生成やレポート作成の基盤データとして利用する。

## 4. 詳細要件
- 収集項目
  - ユーザー識別子（匿名 ID またはユーザー ID）
  - 動画 ID
  - 再生開始時刻／終了時刻
  - 再生完了率
  - 終了理由（完了／スキップ／スクロールアウト）
  - ページ番号（リスト内の位置など）
- 送信タイミング
  - 再生開始時に「開始イベント」、終了時（完了／中断）に「終了イベント」を送信。
  - 通信失敗時には最大5回までリトライし、オンライン復帰を検知した瞬間に再送する。
- 保存
  - ログは後続の分析・レコメンド処理に利用できるよう、永続化する。
  - レコメンド用途で直近3か月分を保持し、それ以降は削除する。
  - 匿名 ID とユーザー ID の紐付け解除タイミングは設けず、保持期間中は紐付けたまま扱う。

## 5. 入出力
- 入力: 視聴ログイベント（各項目）。
- 出力: ログ保存結果（通常はフロントには詳細を返さず、成功／失敗ステータスのみ）。

## 6. 関連
- F02 縦スクロール視聴・レコメンド: 視聴ログ送信のトリガー。
- F03/F07 検索: 検索経由の視聴も同様にログ収集。
- F09 レコメンド: ログを元にスコアリングを行う。

